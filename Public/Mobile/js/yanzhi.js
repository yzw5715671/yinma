// Generated by CoffeeScript 1.9.1
var view1, view2, viewCalc;

view1 = function() {
    var $camera, $countdown, blink, blinkTimer, buildR, countDown, hide, s, showTip, that;
    $countdown = $(".countdown");
    $camera = $(".camera");
    s = 5;
    countDown = function() {
        $countdown.removeClass().addClass("countdown absolute c" + s);
        if (s > 0) {
            setTimeout(countDown, 1100);
        } else {
            setTimeout(showTip, 1e3);
        }
        return s--;
    };
    blinkTimer = 0;
    blink = function() {
        $camera.toggleClass("blink");
        return setTimeout(blink, 300);
    };
    hide = function() {
        return $(".view1").addClass("hidden");
    };
    buildR = function() {
        var r;
        r = parseInt(Math.random() * 1e3) % 5;
        return r + 2;
    };
    showTip = function() {
        var r;
        r = buildR();
        $(".ready").removeClass().addClass("ready absolute t-" + r);
        return setTimeout(function() {
            hide();
            return viewCalc.active();
        }, 3e3);
    };
    that = {};
    that.countDown = countDown;
    that.blink = blink;
    that.hide = hide;
    that.init = function() {};
    return that;
}();

viewCalc = function() {
    var that;
    that = {};
    that.active = function() {
        $(".view1").addClass("hidden");
        $(".view-calc").removeClass("hidden");
        return setTimeout(function() {
            return view2.active();
        }, 2500);
    };
    return that;
}();

view2 = function() {
    var AnimateNum, animateNum, buildR, buildScore, showComment, tada, that;
    AnimateNum = function(o) {
        this.obj = o.obj;
        this.target = o.target.toString();
        this.totalTime = o.totalTime || 2e3;
        this.init();
    };
    AnimateNum.prototype = {
        init: function() {
            if (this.target) {
                this.animation();
                return void 0;
            } else {
                return false;
            }
        },
        animation: function() {
            var a, e, h, i, n, r, s, t;
            t = this;
            i = this.target.indexOf(".");
            e = 0;
            i >= 0 && (e = this.target.length - i - 1);
            n = this.target.replace(".", "");
            s = this.totalTime / 30 | 0;
            a = n / s | 0;
            r = 0;
            h = 0;
            t.timer = setInterval(function() {
                r++;
                h += a;
                t.obj.html(h / Math.pow(10, e));
                if (r >= s) {
                    clearInterval(t.timer);
                    t.obj.html(t.target);
                }
            }, 16.7);
        }
    };
    animateNum = function() {
        var $num;
        $num = $(".animate-num");
        new AnimateNum({
            obj: $num,
            target: $num.data("target"),
            totalTime: 2e3
        });
        setTimeout(showComment, 2e3);
        return setTimeout(tada, 2e3);
    };
    tada = function() {
        /*$('.congratulate').addClass('animated tada').css({
        '-webkit-animation-iteration-count': 'infinite'
        'animation-iteration-count': 'infinite'
        '-webkit-animation-duration': '1.5s'
        'animation-duration': '1.5s'
    })
     */
        $(".congratulate1").addClass("animated tada");
        setTimeout(function() {
            return $(".congratulate1").removeClass("animated tada").width();
        }, 2e3);
        return setTimeout(tada, 3e3);
    };
    buildScore = function() {
        var result;
        result = 80 + parseInt(Math.random() * 1e3) / 1e3 * 40;
        return parseInt(result);
    };
    buildR = function() {
        var r;
        r = parseInt(Math.random() * 1e3) % 3;
        return r + 1;
    };
    showComment = function() {
        var r, sc;
        sc = that.sc;
        r = buildR();
        if (sc < 90) {
            return $(".t-3").removeClass().addClass("t-3 absolute r-80-" + r);
        } else if (sc < 100) {
            return $(".t-3").removeClass().addClass("t-3 absolute r-90-" + r);
        } else {
            return $(".t-3").removeClass().addClass("t-3 absolute r-100-" + r);
        }
    };
    that = {};
    that.animate = function() {
        return animateNum();
    };
    that.init = function() {
        var sc;
        sc = buildScore();
        $(".animate-num").data("target", sc).text(sc);
        return that.sc = sc;
    };
    that.active = function() {
        $(".view1").addClass("hidden");
        $(".view-calc").addClass("hidden");
        $(".view2").removeClass("hidden");
        return that.animate();
    };
    return that;
}();

$(function() {
    view1.countDown();
    view1.blink();
    return view2.init();
});