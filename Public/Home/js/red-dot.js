// Generated by CoffeeScript 1.9.2
var redDot, serverData;

serverData = {};

$('#server-data').children('input').each(function() {
  var $this;
  $this = $(this);
  serverData[$this.attr('name')] = $this.val();
});

redDot = (function() {
  var addRedDot, bindEvent, that;
  that = {};
  bindEvent = function() {
    var buildStr, clickHandler;
    buildStr = function(str, id) {
      var _id, arr, i, len, newArr;
      if (str == null) {
        str = '';
      }
      arr = str.trim().split(',');
      newArr = [];
      for (i = 0, len = arr.length; i < len; i++) {
        _id = arr[i];
        if (_id) {
          newArr.push(parseInt(_id));
        }
      }
      if (newArr.indexOf(id) === -1) {
        newArr.push(id);
      }
      return newArr.join(',');
    };
    clickHandler = function(itemKeyName, $this) {
      var id;
      if ($this.hasClass('red-dot')) {
        $this.removeClass('red-dot');
        id = $this.data('id');
        id = parseInt(id) || 0;
        return localStorage.setItem(itemKeyName, buildStr(localStorage.getItem(itemKeyName), id));
      }
    };
    return $('.item').click(function() {
      var _keyName;
      _keyName = that.type === 'notice' ? 'recentReadNotice' : 'recentReadNews';
      return clickHandler(_keyName, $(this));
    });
  };
  addRedDot = function() {
    var hasNewNews, hasNewNotice, newsList, noticeList, recentReadNews, recentReadNotice;
    localStorage.setItem('recentReadNews', serverData.newslist);
    newsList = serverData.newslist;
    noticeList = serverData.noticelist;
    newsList = newsList ? newsList.split(',') : [];
    noticeList = noticeList ? noticeList.split(',') : [];
    recentReadNews = localStorage.getItem('recentReadNews');
    recentReadNotice = localStorage.getItem('recentReadNotice');
    recentReadNews = recentReadNews ? recentReadNews.split(',') : [];
    recentReadNotice = recentReadNotice ? recentReadNotice.split(',') : [];
    hasNewNews = false;
    hasNewNotice = false;
    return $('.item').each(function() {
      var $this, id;
      $this = $(this);
      id = '' + $this.data('id');
      if (newsList.indexOf(id) > -1 && recentReadNews.indexOf(id) === -1) {
        $this.addClass('red-dot');
        hasNewNews = true;
      }
      if (noticeList.indexOf(id) > -1 && recentReadNotice.indexOf(id) === -1) {
        $this.addClass('red-dot');
        return hasNewNotice = true;
      }
    });
  };
  that.init = function(type) {
    that.type = type;
    addRedDot();
    return bindEvent();
  };
  return that;
})();
